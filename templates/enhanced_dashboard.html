<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .glass-morphism {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }
        .profit-positive { color: #059669; }
        .profit-negative { color: #dc2626; }
        .position-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        .position-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .position-card.profit {
            border-left-color: #059669;
        }
        .position-card.loss {
            border-left-color: #dc2626;
        }
        .metric-card {
            background: linear-gradient(135deg, #93c5fd 0%, #60a5fa 100%);
            transition: transform 0.3s ease;
            padding: 12px;
        }
        .metric-card:hover {
            transform: translateY(-2px);
        }
        .status-indicator {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .sidebar {
            background: #f8fafc;
            border-right: 1px solid #e2e8f0;
        }
        .ticker-item {
            transition: background-color 0.2s ease;
        }
        .ticker-item:hover {
            background-color: #f1f5f9;
        }
        .main-content {
            background: #ffffff;
        }
        .header-bg {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="sidebar w-80 overflow-y-auto">
            <!-- Control Buttons -->
            <div class="glass-morphism rounded-xl p-4 mb-4">
                <div class="flex flex-wrap gap-3 justify-center">
                    <button onclick="startBot()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm">
                        <i class="fas fa-play"></i>
                    </button>
                    <button onclick="stopBot()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm">
                        <i class="fas fa-stop"></i>
                    </button>
                    <button onclick="window.location.href='/trades'" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm">
                        <i class="fas fa-history"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Market Watch</h2>
                
                <!-- Monitored Tickers -->
                <div class="space-y-2" id="monitored-tickers">
                    {% for ticker in monitored_tickers %}
                    <div class="ticker-item p-3 rounded-lg border border-gray-200">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-semibold text-gray-800">{{ ticker.get('symbol', ticker.get('ticker', 'N/A')) }}</p>
                                <p class="text-sm text-gray-600">Rank #{{ ticker.get('rank', loop.index) }}</p>
                            </div>
                            <div class="text-right">
                                <p class="font-semibold text-gray-800">${{ "%.2f"|format(ticker.get('price', 0)) }}</p>
                                <p class="text-sm {% if ticker.get('change_pct', 0) > 0 %}profit-positive{% else %}profit-negative{% endif %}">
                                    {{ "%.2f"|format(ticker.get('change_pct', 0)) }}%
                                </p>
                            </div>
                        </div>
                        {% if ticker.get('volume') %}
                        <div class="mt-2 text-xs text-gray-500">
                            Vol: {{ "{:,}".format(ticker.get('volume', 0)) }}
                        </div>
                        {% endif %}
                    </div>
                    {% else %}
                    <div class="text-center py-8">
                        <i class="fas fa-search text-4xl text-gray-300 mb-2"></i>
                        <p class="text-gray-500">No tickers being monitored</p>
                        <p class="text-gray-400 text-sm">Start bot to see monitored tickers</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content flex-1 overflow-y-auto">
            <div class="p-6">
                <!-- Header Stats -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
                    <div class="metric-card rounded-xl p-3 text-white">
                        <div class="text-center">
                            <p class="text-white/80 text-xs font-medium">Portfolio Value</p>
                            <p class="text-xl font-bold mt-1">${{ "%.2f"|format(bot_status.get('current_capital', 0) + positions.get('total_value', 0)) }}</p>
                        </div>
                    </div>
                    
                    <div class="metric-card rounded-xl p-3 text-white">
                        <div class="text-center">
                            <p class="text-white/80 text-xs font-medium">Active Positions</p>
                            <p class="text-xl font-bold mt-1">{{ positions.get('count', 0) }}</p>
                        </div>
                    </div>
                    
                    <div class="metric-card rounded-xl p-3 text-white">
                        <div class="text-center">
                            <p class="text-white/80 text-xs font-medium">Total Position Value</p>
                            <p class="text-xl font-bold mt-1">${{ "%.2f"|format(positions.get('total_value', 0)) }}</p>
                        </div>
                    </div>
                    
                    <div class="metric-card rounded-xl p-3 text-white">
                        <div class="text-center">
                            <p class="text-white/80 text-xs font-medium">Unrealized P&L</p>
                            <p class="text-xl font-bold mt-1 {% if positions.get('total_unrealized', 0) > 0 %}text-green-300{% else %}text-red-300{% endif %}">
                                ${{ "%.2f"|format(positions.get('total_unrealized', 0)) }}
                            </p>
                        </div>
                    </div>
                    
                    <div class="metric-card rounded-xl p-3 text-white">
                        <div class="text-center">
                            <p class="text-white/80 text-xs font-medium">Daily P&L</p>
                            <p class="text-xl font-bold mt-1 {% if bot_status.get('daily_profit', 0) > 0 %}text-green-300{% else %}text-red-300{% endif %}">
                                ${{ "%.2f"|format(bot_status.get('daily_profit', 0)) }}
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Active Positions -->
                <div class="glass-morphism rounded-xl p-6 mb-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Active Positions</h2>
                        <div class="flex items-center gap-2">
                            <span class="status-indicator w-3 h-3 bg-green-500 rounded-full"></span>
                            <span class="text-gray-600 text-sm">Live</span>
                        </div>
                    </div>

                    {% if positions.get('positions', []) %}
                    <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4">
                        {% for pos in positions.get('positions', []) %}
                        <div class="position-card {% if pos.get('unrealized_pnl', 0) > 0 %}profit{% else %}loss{% endif %} bg-white rounded-xl p-5 border border-gray-200">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-800">{{ pos.get('ticker', 'N/A') }}</h3>
                                    <span class="text-xs text-gray-600 bg-gray-100 px-2 py-1 rounded-full">
                                        {{ pos.get('position_type', 'unknown').title() }}
                                    </span>
                                </div>
                                <div class="text-right">
                                    <p class="text-lg font-bold {% if pos.get('unrealized_pnl', 0) > 0 %}profit-positive{% else %}profit-negative{% endif %}">
                                        ${{ "%.2f"|format(pos.get('unrealized_pnl', 0)) }}
                                    </p>
                                    <p class="text-xs text-gray-600">
                                        {{ "%.2f"|format(pos.get('unrealized_pnl_pct', 0) * 100) }}%
                                    </p>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-3 mb-4">
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <p class="text-xs text-gray-600">Position Size</p>
                                    <p class="text-sm font-semibold text-gray-800">{{ pos.get('shares', 0) }} shares</p>
                                </div>
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <p class="text-xs text-gray-600">Current Value</p>
                                    <p class="text-sm font-semibold text-gray-800">${{ "%.2f"|format(pos.get('current_value', 0)) }}</p>
                                </div>
                            </div>

                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Entry Price</span>
                                    <span class="text-gray-800 font-medium">${{ "%.2f"|format(pos.get('entry_price', 0)) }}</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Current Price</span>
                                    <span class="text-gray-800 font-medium">${{ "%.2f"|format(pos.get('current_price', 0)) }}</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Entry Time</span>
                                    <span class="text-gray-800 font-medium">{{ pos.get('entry_time', 'N/A')[:16] if pos.get('entry_time') else 'N/A' }}</span>
                                </div>
                                {% if pos.get('entry_pattern') %}
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Pattern</span>
                                    <span class="text-gray-800 font-medium">{{ pos.get('entry_pattern') }}</span>
                                </div>
                                {% endif %}
                            </div>

                            <div class="mt-4 pt-4 border-t border-gray-200">
                                <button data-ticker="{{ pos.get('ticker') }}" onclick="closePosition(this.dataset.ticker)" class="w-full bg-red-500/20 hover:bg-red-500/30 text-red-600 py-2 rounded-lg text-sm font-medium transition-colors">
                                    Close Position
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-12">
                        <i class="fas fa-chart-line text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-600 text-lg">No active positions</p>
                        <p class="text-gray-400 text-sm mt-2">Start bot to begin trading</p>
                    </div>
                    {% endif %}
                </div>

                <!-- Performance Chart -->
                <div class="glass-morphism rounded-xl p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Performance Overview</h2>
                    <div class="bg-gray-50 rounded-xl p-4">
                        <canvas id="performanceChart" height="100"></canvas>
                    </div>
                </div>

                <!-- Daily Analysis Report -->
                <div class="glass-morphism rounded-xl p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Daily Trade Analysis</h2>
                        <div class="flex gap-2">
                            <button onclick="refreshDailyAnalysis()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                <i class="fas fa-sync-alt mr-2"></i>Refresh
                            </button>
                            <button onclick="runDailyAnalysis()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                <i class="fas fa-play mr-2"></i>Run Analysis
                            </button>
                        </div>
                    </div>
                    
                    <div id="dailyAnalysisContent">
                        <div class="text-center py-8">
                            <i class="fas fa-spinner fa-spin text-4xl text-blue-500 mb-4"></i>
                            <p class="text-gray-600">Loading daily analysis...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Performance chart
        const ctx = document.getElementById('performanceChart').getContext('2d');
        const currentCapital = JSON.parse('{{ bot_status.current_capital | tojson }}') || 10000;
        const totalPositionValue = JSON.parse('{{ positions.total_value | tojson }}') || 0;
        
        const performanceChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                datasets: [{
                    label: 'Portfolio Value',
                    data: [currentCapital - 500, currentCapital - 300, currentCapital - 150, currentCapital + 300, currentCapital + 450, currentCapital + totalPositionValue],
                    borderColor: 'rgb(59, 130, 246)',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        },
                        ticks: {
                            color: 'rgba(0, 0, 0, 0.7)'
                        }
                    },
                    y: {
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        },
                        ticks: {
                            color: 'rgba(0, 0, 0, 0.7)',
                            callback: function(value) {
                                return '$' + value.toFixed(0);
                            }
                        }
                    }
                }
            }
        });

        // Bot control functions
        function startBot() {
            fetch('/api/start', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success || data.status === 'success') {
                        showNotification('Bot started successfully!', 'success');
                        setTimeout(() => location.reload(), 1000);
                    } else {
                        showNotification('Error starting bot: ' + (data.error || data.message), 'error');
                    }
                });
        }

        function stopBot() {
            fetch('/api/stop', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success || data.status === 'success') {
                        showNotification('Bot stopped successfully!', 'success');
                        setTimeout(() => location.reload(), 1000);
                    } else {
                        showNotification('Error stopping bot: ' + (data.error || data.message), 'error');
                    }
                });
        }

        function closePosition(ticker) {
            if (confirm('Are you sure you want to close position ' + ticker + '?')) {
                fetch('/api/position/close', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ ticker: ticker })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success || data.status === 'success') {
                        showNotification('Position ' + ticker + ' closed successfully!', 'success');
                        setTimeout(() => location.reload(), 1000);
                    } else {
                        showNotification('Error closing position: ' + (data.error || data.message), 'error');
                    }
                });
            }
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 p-4 rounded-lg text-white font-medium z-50 ' +
                (type === 'success' ? 'bg-green-500' : 'bg-red-500');
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Daily Analysis Functions
        function refreshDailyAnalysis() {
            fetch('/api/daily-analysis')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showNotification('Error loading daily analysis: ' + data.error, 'error');
                        return;
                    }
                    displayDailyAnalysis(data);
                })
                .catch(error => {
                    console.error('Error loading daily analysis:', error);
                    showNotification('Error loading daily analysis', 'error');
                });
        }

        function runDailyAnalysis() {
            const button = event.target;
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Running...';
            
            fetch('/api/daily-analysis/run', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-play mr-2"></i>Run Analysis';
                
                if (data.error) {
                    showNotification('Error running analysis: ' + data.error, 'error');
                    return;
                }
                
                displayDailyAnalysis(data);
                showNotification('Daily analysis completed successfully!', 'success');
            })
            .catch(error => {
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-play mr-2"></i>Run Analysis';
                console.error('Error running analysis:', error);
                showNotification('Error running analysis', 'error');
            });
        }

        function displayDailyAnalysis(data) {
            const container = document.getElementById('dailyAnalysisContent');
            
            // Handle no report available status
            if (data.status === 'no_report') {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-chart-line text-4xl text-gray-300 mb-4"></i>
                        <p class="text-gray-600 text-lg">${data.message}</p>
                        <p class="text-gray-400 text-sm mt-2">Date: ${data.date}</p>
                    </div>
                `;
                return;
            }
            
            if (!data || data.total_trades === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-chart-line text-4xl text-gray-300 mb-4"></i>
                        <p class="text-gray-600 text-lg">No trades analyzed for ${data.date || 'today'}</p>
                        <p class="text-gray-400 text-sm mt-2">Run analysis or wait for trades to execute</p>
                    </div>
                `;
                return;
            }

            const pnlClass = data.total_pnl >= 0 ? 'profit-positive' : 'profit-negative';
            const winRateClass = data.win_rate >= 50 ? 'profit-positive' : 'profit-negative';
            
            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <!-- Key Metrics -->
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-blue-600 font-medium">Total P&L</p>
                                <p class="text-2xl font-bold ${pnlClass}">$${data.total_pnl.toFixed(2)}</p>
                            </div>
                            <i class="fas fa-dollar-sign text-2xl text-blue-500"></i>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-green-600 font-medium">Win Rate</p>
                                <p class="text-2xl font-bold ${winRateClass}">${data.win_rate.toFixed(1)}%</p>
                            </div>
                            <i class="fas fa-trophy text-2xl text-green-500"></i>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-purple-600 font-medium">Total Trades</p>
                                <p class="text-2xl font-bold text-gray-800">${data.total_trades}</p>
                            </div>
                            <i class="fas fa-chart-bar text-2xl text-purple-500"></i>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-orange-600 font-medium">Profit Factor</p>
                                <p class="text-2xl font-bold text-gray-800">${data.profit_factor.toFixed(2)}</p>
                            </div>
                            <i class="fas fa-balance-scale text-2xl text-orange-500"></i>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Performance Details -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Performance Details</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Winning Trades</span>
                                <span class="font-medium">${data.winning_trades}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Losing Trades</span>
                                <span class="font-medium">${data.losing_trades}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Average Win</span>
                                <span class="font-medium profit-positive">$${data.avg_win.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Average Loss</span>
                                <span class="font-medium profit-negative">$${data.avg_loss.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Largest Win</span>
                                <span class="font-medium profit-positive">$${data.largest_win.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Largest Loss</span>
                                <span class="font-medium profit-negative">$${data.largest_loss.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Avg Hold Time</span>
                                <span class="font-medium">${data.avg_hold_time.toFixed(1)} min</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Sharpe Ratio</span>
                                <span class="font-medium">${data.sharpe_ratio.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Max Drawdown</span>
                                <span class="font-medium profit-negative">$${data.max_drawdown.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Pattern Performance -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Pattern Analysis</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Best Pattern</span>
                                <span class="font-medium profit-positive">${data.best_pattern}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Worst Pattern</span>
                                <span class="font-medium profit-negative">${data.worst_pattern}</span>
                            </div>
                        </div>
                        
                        ${Object.keys(data.pattern_performance || {}).length > 0 ? `
                            <div class="mt-4">
                                <h4 class="text-sm font-semibold text-gray-700 mb-2">Pattern Breakdown</h4>
                                <div class="space-y-2">
                                    ${Object.entries(data.pattern_performance).map(([pattern, stats]) => `
                                        <div class="flex justify-between text-sm">
                                            <span class="text-gray-600">${pattern}</span>
                                            <div class="text-right">
                                                <span class="font-medium">${stats.trades} trades</span>
                                                <span class="ml-2 ${stats.total_pnl >= 0 ? 'profit-positive' : 'profit-negative'}">
                                                    $${stats.total_pnl.toFixed(2)}
                                                </span>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>

                ${data.recommendations && data.recommendations.length > 0 ? `
                    <div class="mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <h3 class="text-lg font-semibold text-yellow-800 mb-3">
                            <i class="fas fa-lightbulb mr-2"></i>Recommendations
                        </h3>
                        <ul class="space-y-2">
                            ${data.recommendations.map(rec => `
                                <li class="flex items-start">
                                    <i class="fas fa-chevron-right text-yellow-600 mt-1 mr-2 text-sm"></i>
                                    <span class="text-yellow-800">${rec}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                ` : ''}

                <div class="mt-4 text-center text-sm text-gray-500">
                    Analysis for ${data.date} | Generated at ${new Date().toLocaleTimeString()}
                </div>
            `;
        }

        // Load daily analysis on page load
        document.addEventListener('DOMContentLoaded', function() {
            refreshDailyAnalysis();
        });

        // Auto-refresh every 5 seconds for real-time updates
        setInterval(() => {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    // Update positions data
                    return fetch('/api/positions');
                })
                .then(response => response.json())
                .then(positionsData => {
                    // Update monitored tickers
                    return fetch('/api/tickers');
                })
                .then(response => response.json())
                .then(tickersData => {
                    updateMonitoredTickers(tickersData);
                })
                .catch(error => console.error('Error refreshing data:', error));
        }, 5000);
        
        function updateMonitoredTickers(tickersData) {
            const tickerContainer = document.getElementById('monitored-tickers');
            if (!tickerContainer) return;
            
            if (tickersData.length === 0) {
                tickerContainer.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-search text-4xl text-gray-300 mb-2"></i>
                        <p class="text-gray-500">No tickers being monitored</p>
                        <p class="text-gray-400 text-sm">Start bot to see monitored tickers</p>
                    </div>
                `;
                return;
            }
            
            tickerContainer.innerHTML = tickersData.map((ticker, index) => `
                <div class="ticker-item p-3 rounded-lg border border-gray-200">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-semibold text-gray-800">${ticker.symbol || ticker.ticker || 'N/A'}</p>
                            <p class="text-sm text-gray-600">Rank #${ticker.rank || index + 1}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold text-gray-800">$${ticker.price.toFixed(2)}</p>
                            <p class="text-sm ${ticker.change_pct > 0 ? 'profit-positive' : 'profit-negative'}">
                                ${ticker.change_pct.toFixed(2)}%
                            </p>
                        </div>
                    </div>
                    ${ticker.volume ? `
                        <div class="mt-2 text-xs text-gray-500">
                            Vol: ${ticker.volume.toLocaleString()}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }
    </script>
</body>
</html>
